---
const { title } = Astro.props;
import SearchBox from "../components/SearchBox.astro";
import i18next, { t } from "i18next";
import { Trans, HeadHrefLangs } from "astro-i18next/components";
import Footer from "../components/Footer.astro";
import Navbar from "../components/Navbar.astro";

const currentLang = i18next.language;
const currentPath = Astro.url.pathname.replace(/^\/[a-z]{2}/, "") || "/";
const otherLang = currentLang === "th" ? "en" : "th";
---

<html lang={currentLang}>
  <head>
    <meta charset="UTF-8" />
    <title>{title ?? t("siteTitle")}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={t("siteDescription")} />

    <link rel="preload" href="/Logo.png" as="image" />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
      integrity="sha384-<INTEGRITY_HASH>"
      crossorigin="anonymous"></script>

    <HeadHrefLangs />
  </head>

  <body class="font-sans text-gray-800 m-0 p-0 min-h-screen flex flex-col">
    <header class="sticky top-0 z-50 bg-white shadow">
      <div
        class="container mx-auto flex items-center justify-between border-b px-4 sm:px-6 lg:px-8"
      >
        <div class="flex-shrink-0">
          <a href={`/${currentLang}`} aria-label="Home">
            <img
              src="/Logo.png"
              alt={t("logoAlt")}
              width="160"
              height="80"
              class="h-20 object-contain"
              loading="eager"
            />
          </a>
        </div>

        <div class="flex items-center gap-4">
          <SearchBox />
          <a
            href={`/${otherLang}${currentPath}`}
            class="text-lg font-bold text-gray-600 no-underline hover:text-gray-900 transition-colors px-3 py-2 rounded hover:bg-gray-100"
            aria-label={currentLang === "th"
              ? "Switch to English"
              : "เปลี่ยนเป็นภาษาไทย"}
            hreflang={otherLang}
          >
            {currentLang === "th" ? "EN" : "TH"}
          </a>
        </div>
      </div>
      <Navbar />
    </header>

    <main class="flex-grow">
      <slot />
    </main>
    <Footer />
  </body>
</html>
